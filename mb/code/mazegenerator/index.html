<!DOCTYPE html>
<html>
  <head>
    <title>Maze generator</title>
    
    <!-- include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js">
    </script>
    
    <!-- include Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous">
    </script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    
    <style>
    
      body {
        font-family: monospace;
        width: 95%;
        margin: 10px;
      }
      
      #mazeout table {
        table-layout: fixed;
        width: 1000px;
      }
      
      #mazeout td {
        overflow: hidden;
      }
      
      #mazeout td.n {
        border-top: 1px solid white;
      }
      
      #mazeout td.s {
        border-bottom: 1px solid white;
      }
      
      #mazeout td.e {
        border-right: 1px solid white;
      }
      
      #mazeout td.w {
        border-left: 1px solid white;
      }
      
      #mazecanvas canvas {
        background-color: #fff;
      }
      
      #mazetable td {
        padding: 5px 10px 5px 5px;
      }
      
      .grid {
        
        border: 1px solid black;
        height: 5px;
        width: 5px;
        background-color: white;
      }
      
    </style>
  </head>

  <body>
  
    <h4>Maze generator</h4>

    <form name="mazein" onsubmit="process(); return false;">
      <table id="mazetable">
        <tr>
          <td>
            h: <input name="height" size=2>&nbsp;
            w: <input name="width" size=2>&nbsp;
            grid size: <input name="gridsize" size=2>&nbsp;
          </td>
        </tr>
        <tr>
          <td>
            algorithm: 
            <br>
            <select name="algorithm">
              <option value="backtracker">Recursive Backtracker</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            animate: <input name="animate" type="checkbox" checked>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <input type="submit"> <input type="reset">
          </td>
        </tr>
      </table>
    </form>
    
    <br>
    <div id="mazeout"></div>
    <canvas id="mazecanvas" width=0 height=0></canvas>
    
    <script src="cell.js"></script>
    <script src="maze.js"></script>
    <script src="backtracker.js"></script>
    
    <script>
      /* todo: fix overdrawing walls, just draw N & E?
       * add djikstra's, solver
       * animate algorithm help:
       * http://stackoverflow.com/questions/17719662/animating-a-recursive-backtracking-algorithm-in-javascript
       * http://stackoverflow.com/questions/29588816/animate-javascript-canvas-while-in-recursive-calculation
       */
      
      // global variables
      let canvas;
      let ctx;
      let grid;
      let width; 
      let height;
      let animate;
      let animationSpeed;
      let maze;
      let animStates;
      
      function process() {
        
        // grab canvas and context from DOM
        canvas = document.getElementById("mazecanvas");
        ctx = canvas.getContext("2d");
        
        let userForm = document.forms["mazein"].elements;
        width = parseInt(userForm["width"].value) || 20;
        height = parseInt(userForm["height"].value) || 20;
        animate = userForm["animate"].checked;
        animationSpeed = 1;
        animStates = [];
        
        maze = new Maze(width, height);
        maze.init();
        maze.grid[0][0].n = true;
        maze.grid[maze.height - 1][maze.width - 1].s = true;
        document.getElementById("mazeout").innerHTML = maze.toHTML();
      
        new Backtracker().carve(maze);
        
        if (animate) {
          let interval = setInterval(function() {
            //animStates.shift().draw();
            if (animStates.length > 0) {
              let frame = animStates.shift();
              document.getElementById(frame[0]).className = frame[1].getClass();
            }
            else {
              clearInterval(interval);
            }
          }, animationSpeed);
        }
        else {
          document.getElementById("mazeout").innerHTML = maze.toHTML();
        }
        
        grid = userForm["gridsize"].value || 10;
        $(".grid").css('width', grid + "px");
        $(".grid").css('height', grid + "px");
      }
      
    </script>
    
    <!-- jQuery script to prevent forms from refreshing the page on submit -->
    <script>
      $(document).ready(function() {
        $(function() {
          $("form").submit(function() { return false; });
        });
      });
    </script>

  </body>
</html>